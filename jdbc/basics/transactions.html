<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
    

<html lang="en-US" xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Using Transactions (The Java&trade; Tutorials &gt;        
            JDBC Database Access &gt; JDBC Basics)
</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
     <meta name="description" content="This JDBC Java tutorial describes how to use JDBC API to create, insert into, update, and query tables. You will also learn how to use simple and prepared statements, stored procedures and perform transactions" />
     <meta name="keywords" content="java programming, learn java, java sample code, jdbc, prepared statement, result set" />
        
<style type="text/css">
    body {
        margin-left:10px;
        margin-right:10px;
        line-height: 1.5;
        FONT-FAMILY: Arial, Helvetica, sans-serif; 
        font-size: 0.8em;
    }
    
    a:link{text-decoration:none; color:#09569d;}
    a:visited{text-decoration:none; color: #3a87cf;}
    a:hover{text-decoration:underline; }
        
    code{
        font-family:Monaco,Courier,"Courier New";
    }
    
    .header-container {
        background-color: #fff;
        border-bottom: 1px solid #C1CFDA;
        -webkit-box-shadow: 0 2px 2px rgba(117, 163, 231, 0.1);
        box-shadow: 0 2px 2px rgba(117, 163, 231, 0.1);
    }
    
    .bookwrapper {
        width: auto;
        margin: auto;
    }
    
    .clearfix {
    }
    
    .clearfloat {
        clear: both;
        overflow: auto;
        height: 0px;
        font-size: 1px;
        line-height: 0px;
    }
    
    #brandProdName {
        width: auto;
        height: auto;
    }
    
    #logocover {
        display: block;
        background: transparent url(../../images/oracle-java-logo.png) 0px 0px no-repeat;
        height: 50px;
        width: 229px;
        float: left;
    }
    
    #productName {
        font-size: 16px;
        position: relative;
        top: 19px;
        padding-left: 3px;
        color: #457798;
        white-space: nowrap;
        width: 340px;
    }


    .FigureCaption   { 
        font-family: sans-serif; 
        text-align: center;
    }
    
    #TopBar_bl {        
        width: 100%;
        height: 60px;
    }
    #TopBar_br {
        width: 100%;
        height: 60px;
    }
    #TopBar_tl {
        margin-left: -110px;
        margin-right: -100px;       
		align: left;
        height: 60px;
    }
    #TopBar_tr {
        width: 100%;
        height: 60px;
    }
    
    #TopBar {
        min-width:700px;
        padding:25px 100px 10px;
        margin-bottom:25px;
        clear:both;
        
        border-bottom:1px solid #d2dde5;
        border-radius: 3px;
    
        background:#efefef; /* Old browsers */
        /* IE9 SVG, needs conditional override of 'filter' to 'none' */
        background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlMmVmZjkiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);
        background: -moz-linear-gradient(top,  #ffffff 0%, #e2eff9 100%); /* FF3.6+ */
        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#ffffff), color-stop(100%,#e2eff9)); /* Chrome,Safari4+ */
        background: -webkit-linear-gradient(top,  #ffffff 0%,#e2eff9 100%); /* Chrome10+,Safari5.1+ */
        background: -o-linear-gradient(top,  #ffffff 0%,#e2eff9 100%); /* Opera 11.10+ */
        background: -ms-linear-gradient(top,  #ffffff 0%,#e2eff9 100%); /* IE10+ */
        background: linear-gradient(to bottom,  #ffffff 0%,#e2eff9 100%); /* W3C */
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffffff', endColorstr='#e2eff9',GradientType=0 ); /* IE6-8 */
        
    }
    
    #TopBar_left {
        line-height: 14px;
        position: absolute;
        padding-top: 30px;
        padding-right: 30px;
        padding-left: 30px;
        text-align: left;
        font: 13px/20px Arial, Helvetica, sans-serif;
        font-weight: bold;
        font-size: 20px;
        color: #333;
    }
    
    #TopBar_right {
        line-height: 12px;
        float: right;
        padding-top: 10px;
        padding-right: 30px;
        text-align: left;
    }
    

    @media print {
        #BreadCrumbs, #Download {
            display: none;
        }
    }
    
     
    @media print {
        #TopBar_right {
            display: none;
        }
    }
    #TopBar_right a {
        font-size: 10px;
        margin: 3px;
        padding: 0;
    }
 
    #BreadCrumbs {
        padding: 15px 5px 0.5em 0;
        font-family: sans-serif; 
        float: right;
    }
    
    #BreadCrumbs a {
        color:#09569d;
    }
    
    #BreadCrumbs a:visited, #BreadCrumbs a:link {
        text-decoration: none;
    }
    
    #BreadCrumbs a:hover, #BreadCrumbs a:active {
        text-decoration: underline;
    }
    
    #PageTitle {
        margin: 0 5px 0.5em 0;
        color: #F90000;
    }
    
    #PageContent{
        margin: 0 5px 0 20px;
    }
    
    .LeftBar_shown {
        width: 13em;
        float: left;
    }
    
    @media print {
        .LeftBar_shown {
            display: none;
        }
    }
    
    .LeftBar_hidden {
        display: none;
    }
    
    #Footer {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;       
    }
    
    .footertext {
        font-size: 10px;
        font-family: sans-serif; 
        margin-top: 1px;
    }

    .NavBit  {
        padding: 15px 5px 0.5em 0;
        font-family: sans-serif; 
    }
    
    @media print {
        .NavBit {
            display: none;
        }
    }
    
    #TagNotes {
        text-align: right;        
    }
    
    @media print {
        #TagNotes a:visited, #TagNotes a:link {
            color: #35556B;
            text-decoration: none;
        }
    }
    
    #Contents a, .NavBit a, #TagNotes a {
        color:#09569d;
    }
    
    #TagNotes a:visited, #TagNotes a:link,
    #Contents a:visited, #Contents a:link,
    .NavBit a:visited, .NavBit a:link {
        text-decoration: none;
    }
    
    #TagNotes a:hover, #TagNotes a:active,   
    #Contents a:hover, #Contents a:active,   
    .NavBit a:hover, .NavBit a:active {  
        text-decoration: underline;
    }
    
    #Contents {
        float: left;
        font-family: sans-serif; 
    }
    @media print {
        #Contents {
            display: none;
        }
    }
    @media screen {
        div.PrintHeaders {
            display: none;
        }
    }
    .linkLESSON, .nolinkLESSON {
        margin-left: 0.5em;
        text-indent: -0.5em;
    }
    .linkAHEAD, .nolinkAHEAD, .linkQUESTIONS, .nolinkQUESTIONS   {
        margin-left: 1.5em; 
        text-indent: -0.5em
    }
    .linkBHEAD, .nolinkBHEAD   {
        margin-left: 2.5em;
        text-indent: -0.5em
    }
    .linkCHEAD, .nolinkCHEAD   {
        margin-left: 3.5em;
        text-indent: -0.5em
    }
    .nolinkLESSON, .nolinkAHEAD, .nolinkBHEAD, .nolinkCHEAD,
    .nolinkQUESTIONS {
        font-weight: bold;
        color: #333;
		
		
    }
    .MainFlow_indented {
        margin-right: 10px;
        margin-left: 15em;
        margin-bottom: 2em;

    }
    .MainFlow_wide {
	
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 2em;

    }
    @media print {
        .MainFlow_indented, .MainFlow_wide {
            padding-top: 0;
            margin-top: 10px;
            margin-right: 10px;
            margin-left: 0;
        }
    }
    h1, h2, h3, h4, h5 {
        color: #333;
        
    }

    h1 {
        font-weight: bold;
        font-size: 20px;
    }

    h2 {
        font-weight: bold;
        font-size: 17px;
    }

    h3 {
        font-weight: bold;
        font-size: 14px;
    }

    h4 {
        font-size: 15px;
    }

    h5 {
        font-size: 12px;
    }


    #ToggleLeft {
        display: none;
    }
    
    .note {
        margin: 0 30px 0px 30px;
    }
    
    .codeblock {
        margin: 0 30px 0px 30px;
		font-size:12px;
		font-family:Monaco,Courier,"Courier New";
    }
    
    .tocli {
        list-style-type:none;
    }

    .betadraft {
        color: red;
    }

</style>
<script type="text/javascript">
/* <![CDATA[ */
    function leftBar() {
        var nameq = 'tutorial_showLeftBar='
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookieString = cookies[i];
            while (cookieString.charAt(0) == ' ') {
                cookieString = cookieString.substring(1, cookieString.length);
            }
            if (cookieString.indexOf(nameq) == 0) {
                cookieValue =  cookieString.substring(nameq.length,
                        cookieString.length);
                return cookieValue == 'yes';
            }
        }
        return true;
    }

    function showLeft(b) {
        var contents = document.getElementById("LeftBar");
        var main = document.getElementById("MainFlow");
        var toggle = document.getElementById("ToggleLeft");
        if (b) {
            contents.className = "LeftBar_shown";
            main.className = "MainFlow_indented";
            toggle.innerHTML = "Hide TOC";
            document.cookie = 'tutorial_showLeftBar=yes; path=/';
        } else {
            contents.className = "LeftBar_hidden";
            main.className = "MainFlow_wide";
            toggle.innerHTML = "Show the TOC";
            document.cookie = 'tutorial_showLeftBar=no; path=/';
        }
    }

    function toggleLeft() {
        showLeft(document.getElementById("LeftBar").className ==
                "LeftBar_hidden");
        document.getElementById("ToggleLeft").blur();
    }

    function load() {
        showLeft(leftBar());
        document.getElementById("ToggleLeft").style.display="inline";
    }

    function showCode(displayCodePage, codePath) {
        var codePathEls = codePath.split("/");
        var currDocPathEls = location.href.split("/");
        //alert ("codePathEls = " + codePathEls + "\n" + "currDocPathEls = " + currDocPathEls);
        currDocPathEls.pop(); // remove file name at the end
        while (codePathEls.length > 0) {
            if (codePathEls[0] == "..") {
                codePathEls.shift();
                currDocPathEls.pop();
            } else {
                break;
            }
        }
        var fullCodePath = currDocPathEls.join("/") + "/" + codePathEls.join("/");
        //alert ("fullCodePath = " + fullCodePath );
        if (codePath.indexOf(".java") != -1 || codePath.indexOf(".jnlp") != -1) {
            window.location.href = displayCodePage + "?code=" + encodeURI(fullCodePath);
        } else {
            window.location.href = fullCodePath;
        }
    }
/* ]]> */    
</script>


    </head>
<body onload="load()">
    <noscript>
        A browser with JavaScript enabled is required for this page to operate properly.
    </noscript>
        <!-- header -->
    <div class="header-container">
        <div class="bookwrapper  clearfix">       
            <div id="brandProdName">
                <div id="logocover"></div>
                <div id="productName" >Documentation</div>
            </div> 
            <br class="clearfloat" />
        </div>
    </div>
    
    <div id="TopBar">
        <div id="TopBar_tr">
            <div id="TopBar_tl">
                <div id="TopBar_br"> <div id="TopBar_bl"> 
                    <div id="TopBar_left">The Java&trade; Tutorials</div>
                        <div id="TopBar_right"> 
                            <!--
                            <a href="URL" target="_blank">External Link</a><br/>
                            -->

<script type="text/javascript">function search() { var sform = document.getElementById("searchForm"); var srchelem = document.getElementById("searchField"); var srchelemreal = document.getElementById("keywordreal"); var srchval = srchelem.value; if (srchval.length == 0) { return false; } srchelemreal.value = srchval; sform.action = "http://docs.oracle.com/apps/search/search.jsp"; sform.method = "get"; sform.target = "_blank"; sform.submit(); }</script><form id="searchForm" onsubmit="return search()"><input type="hidden" name="category" value="java"/><input type="hidden" name="product" value="e25407-01"/><input type="hidden" name="q" value="" id="keywordreal"/><label for="searchField"><input type="text" id="searchField" size="30" onclick="this.value='';" /></label><input type="submit" value="Search" /></form>
              
                            <a href="javascript:toggleLeft()" id="ToggleLeft">Hide TOC</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="LeftBar" class="LeftBar_shown">
        <div id="Contents">
            <div class="linkLESSON"><a href="index.html">JDBC Basics</a></div>
<div class="linkAHEAD"><a href="gettingstarted.html">Getting Started</a></div>
<div class="linkAHEAD"><a href="processingsqlstatements.html">Processing SQL Statements with JDBC</a></div>
<div class="linkAHEAD"><a href="connecting.html">Establishing a Connection</a></div>
<div class="linkAHEAD"><a href="sqldatasources.html">Connecting with DataSource Objects</a></div>
<div class="linkAHEAD"><a href="sqlexception.html">Handling SQLExceptions</a></div>
<div class="linkAHEAD"><a href="tables.html">Setting Up Tables</a></div>
<div class="linkAHEAD"><a href="retrieving.html">Retrieving and Modifying Values from Result Sets</a></div>
<div class="linkAHEAD"><a href="prepared.html">Using Prepared Statements</a></div>
<div class="nolinkAHEAD">Using Transactions</div>
<div class="linkAHEAD"><a href="rowset.html">Using RowSet Objects</a></div>
<div class="linkAHEAD"><a href="jdbcrowset.html">Using JdbcRowSet Objects</a></div>
<div class="linkAHEAD"><a href="cachedrowset.html">Using CachedRowSetObjects</a></div>
<div class="linkAHEAD"><a href="joinrowset.html">Using JoinRowSet Objects</a></div>
<div class="linkAHEAD"><a href="filteredrowset.html">Using FilteredRowSet Objects</a></div>
<div class="linkAHEAD"><a href="webrowset.html">Using WebRowSet Objects</a></div>
<div class="linkAHEAD"><a href="sqltypes.html">Using Advanced Data Types</a></div>
<div class="linkAHEAD"><a href="blob.html">Using Large Objects</a></div>
<div class="linkAHEAD"><a href="sqlxml.html">Using SQLXML Objects</a></div>
<div class="linkAHEAD"><a href="array.html">Using Array Objects</a></div>
<div class="linkAHEAD"><a href="distinct.html">Using DISTINCT Data Type</a></div>
<div class="linkAHEAD"><a href="sqlstructured.html">Using Structured Objects</a></div>
<div class="linkAHEAD"><a href="sqlcustommapping.html">Using Customized Type Mappings</a></div>
<div class="linkAHEAD"><a href="sqldatalink.html">Using Datalink Objects</a></div>
<div class="linkAHEAD"><a href="sqlrowid.html">Using RowId Objects</a></div>
<div class="linkAHEAD"><a href="storedprocedures.html">Using Stored Procedures</a></div>
<div class="linkAHEAD"><a href="jdbcswing.html">Using JDBC with GUI API</a></div>
</div>
    </div>
    <div id="MainFlow" class="MainFlow_indented">
    <div class="PrintHeaders">
        <b>Trail:</b> JDBC Database Access
        <br /><b>Lesson:</b> JDBC Basics
    </div>
            <div id="BreadCrumbs">
                <a href="../../index.html" target="_top">Home Page</a>
                &gt;
                <a href="../index.html" target="_top">JDBC Database Access</a>
                &gt;
                <a href="index.html" target="_top">JDBC Basics</a>
            </div>
            <div class="NavBit">
                <a target="_top" href="prepared.html">&laquo;&nbsp;Previous</a>&nbsp;&bull;&nbsp;<a target="_top" href="../TOC.html">Trail</a>&nbsp;&bull;&nbsp;<a target="_top" href="rowset.html">Next&nbsp;&raquo;</a>
            </div>
            <div class="Banner"><p style="background-color: rgb(247, 248, 249); border-width: 1px; padding: 10px; font-style: italic; border-style: solid; border-color: rgb(64, 74, 91);">The Java Tutorials have been written for JDK 8. Examples and practices described in this page don't take advantage of improvements introduced in later releases and might use technology no longer available.<br/>See <a href="https://docs.oracle.com/pls/topic/lookup?ctx=en/java/javase&id=java_language_changes">Java Language Changes</a> for a summary of updated language features in Java SE 9 and subsequent releases.<br/>See <a href="https://www.oracle.com/technetwork/java/javase/jdk-relnotes-index-2162236.html">JDK Release Notes</a> for information about new features, enhancements, and removed or deprecated options for all JDK releases.</p></div>
            <div id="PageTitle"><h1>Using Transactions</h1></div>
            <div id="PageContent">

<p>There are times when you do not want one statement to take effect unless another one completes. For example, when the proprietor of The Coffee Break updates the amount of coffee sold each week, the proprietor will also want to update the total amount sold to date. However, the amount sold per week and the total amount sold should be updated at the same time; otherwise, the data will be inconsistent. The way to be sure that either both actions occur or neither action occurs is to use a transaction. A transaction is a set of one or more statements that is executed as a unit, so either all of the statements are executed, or none of the statements is executed.</p>
<p>This page covers the following topics</p>
<ul>
<li><a href="#disable_auto_commit">Disabling Auto-Commit Mode</a></li>
<li><a href="#commit_transactions">Committing Transactions</a></li>
<li><a href="#transactions_data_integrity">Using Transactions to Preserve Data Integrity</a></li>
<li><a href="#set_roll_back_savepoints">Setting and Rolling Back to Savepoints</a></li>
<li><a href="#release_savepoints">Releasing Savepoints</a></li>
<li><a href="#call_rollback">When to Call Method rollback</a></li>
</ul>
<!-- ************************************** -->
<h2><a name="disable_auto_commit" id="disable_auto_commit">Disabling Auto-Commit Mode</a></h2>
<p>When a connection is created, it is in auto-commit mode. This means that each individual SQL statement is treated as a transaction and is automatically committed right after it is executed. (To be more precise, the default is for a SQL statement to be committed when it is completed, not when it is executed. A statement is completed when all of its result sets and update counts have been retrieved. In almost all cases, however, a statement is completed, and therefore committed, right after it is executed.)</p>
<p>The way to allow two or more statements to be grouped into a transaction is to disable the auto-commit mode. This is demonstrated in the following code, where <code>con</code> is an active connection:</p>
<div class="codeblock"><pre>
con.setAutoCommit(false);
</pre></div>
<!-- ************************************** -->
<h2><a name="commit_transactions" id="commit_transactions">Committing Transactions</a></h2>
<p>After the auto-commit mode is disabled, no SQL statements are committed until you call the method <code>commit</code> explicitly. All statements executed after the previous call to the method <code>commit</code> are included in the current transaction and committed together as a unit. The following method, <code><a href="gettingstarted.html">CoffeesTable.updateCoffeeSales</a></code>, in which <code>con</code> is an active connection, illustrates a transaction:</p>
<div class="codeblock"><pre>
  public void updateCoffeeSales(HashMap&lt;String, Integer> salesForWeek) throws SQLException {
    String updateString =
      "update COFFEES set SALES = ? where COF_NAME = ?";
    String updateStatement =
      "update COFFEES set TOTAL = TOTAL + ? where COF_NAME = ?";

    try (PreparedStatement updateSales = con.prepareStatement(updateString);
         PreparedStatement updateTotal = con.prepareStatement(updateStatement))
    
    {
      con.setAutoCommit(false);
      for (Map.Entry&lt;String, Integer> e : salesForWeek.entrySet()) {
        updateSales.setInt(1, e.getValue().intValue());
        updateSales.setString(2, e.getKey());
        updateSales.executeUpdate();

        updateTotal.setInt(1, e.getValue().intValue());
        updateTotal.setString(2, e.getKey());
        updateTotal.executeUpdate();
        con.commit();
      }
    } catch (SQLException e) {
      JDBCTutorialUtilities.printSQLException(e);
      if (con != null) {
        try {
          System.err.print("Transaction is being rolled back");
          con.rollback();
        } catch (SQLException excep) {
          JDBCTutorialUtilities.printSQLException(excep);
        }
      }
    }
  }
</pre></div>
<p>In this method, the auto-commit mode is disabled for the connection <code>con</code>, which means that the two prepared statements <code>updateSales</code> and <code>updateTotal</code> are committed together when the method <code>commit</code> is called. Whenever the <code>commit</code> method is called (either automatically when auto-commit mode is enabled or explicitly when it is disabled), all changes resulting from statements in the transaction are made permanent. In this case, that means that the <code>SALES</code> and <code>TOTAL</code> columns for Colombian coffee have been changed to <code>50</code> (if <code>TOTAL</code> had been <code>0</code> previously) and will retain this value until they are changed with another update statement.</p>
<p>The statement <code>con.setAutoCommit(true);</code> enables auto-commit mode, which means that each statement is once again committed automatically when it is completed. Then, you are back to the default state where you do not have to call the method <code>commit</code> yourself. It is advisable to disable the auto-commit mode only during the transaction mode. This way, you avoid holding database locks for multiple statements, which increases the likelihood of conflicts with other users.</p>
<!-- ************************************** -->
<h2><a name="transactions_data_integrity" id="transactions_data_integrity">Using Transactions to Preserve Data Integrity</a></h2>
<p>In addition to grouping statements together for execution as a unit, transactions can help to preserve the integrity of the data in a table. For instance, imagine that an employee was supposed to enter new coffee prices in the table <code>COFFEES</code> but delayed doing it for a few days. In the meantime, prices rose, and today the owner is in the process of entering the higher prices. The employee finally gets around to entering the now outdated prices at the same time that the owner is trying to update the table. After inserting the outdated prices, the employee realizes that they are no longer valid and calls the <code>Connection</code> method <code>rollback</code> to undo their effects. (The method <code>rollback</code> aborts a transaction and restores values to what they were before the attempted update.) At the same time, the owner is executing a <code>SELECT</code> statement and printing the new prices. In this situation, it is possible that the owner will print a price that had been rolled back to its previous value, making the printed price incorrect.</p>
<p>This kind of situation can be avoided by using transactions, providing some level of protection against conflicts that arise when two users access data at the same time.</p>
<p>To avoid conflicts during a transaction, a DBMS uses locks, mechanisms for blocking access by others to the data that is being accessed by the transaction. (Note that in auto-commit mode, where each statement is a transaction, locks are held for only one statement.) After a lock is set, it remains in force until the transaction is committed or rolled back. For example, a DBMS could lock a row of a table until updates to it have been committed. The effect of this lock would be to prevent a user from getting a dirty read, that is, reading a value before it is made permanent. (Accessing an updated value that has not been committed is considered a <em>dirty read</em> because it is possible for that value to be rolled back to its previous value. If you read a value that is later rolled back, you will have read an invalid value.)</p>
<p>How locks are set is determined by what is called a transaction isolation level, which can range from not supporting transactions at all to supporting transactions that enforce very strict access rules.</p>
<p>One example of a transaction isolation level is <code>TRANSACTION_READ_COMMITTED</code>, which will not allow a value to be accessed until after it has been committed. In other words, if the transaction isolation level is set to <code>TRANSACTION_READ_COMMITTED</code>, the DBMS does not allow dirty reads to occur. The interface <code>Connection</code> includes five values that represent the transaction isolation levels you can use in JDBC:</p>
<table border="1" summary="Transaction isolation levels">
<tr>
<th id="h1">Isolation Level</th>
<th id="h2">Transactions</th>
<th id="h3">Dirty Reads</th>
<th id="h4">Non-Repeatable Reads</th>
<th id="h5">Phantom Reads</th>
</tr>
<tr>
<td headers="h1"><code>TRANSACTION_NONE</code></td>
<td headers="h2">Not supported</td>
<td headers="h3"><em>Not applicable</em></td>
<td headers="h4"><em>Not applicable</em></td>
<td headers="h5"><em>Not applicable</em></td>
</tr>
<tr>
<td headers="h1"><code>TRANSACTION_READ_COMMITTED</code></td>
<td headers="h2">Supported</td>
<td headers="h3">Prevented</td>
<td headers="h4">Allowed</td>
<td headers="h5">Allowed</td>
</tr>
<tr>
<td headers="h1"><code>TRANSACTION_READ_UNCOMMITTED</code></td>
<td headers="h2">Supported</td>
<td headers="h3">Allowed</td>
<td headers="h4">Allowed</td>
<td headers="h5">Allowed</td>
</tr>
<tr>
<td headers="h1"><code>TRANSACTION_REPEATABLE_READ</code></td>
<td headers="h2">Supported</td>
<td headers="h3">Prevented</td>
<td headers="h4">Prevented</td>
<td headers="h5">Allowed</td>
</tr>
<tr>
<td headers="h1"><code>TRANSACTION_SERIALIZABLE</code></td>
<td headers="h2">Supported</td>
<td headers="h3">Prevented</td>
<td headers="h4">Prevented</td>
<td headers="h5">Prevented</td>
</tr>
</table>
<p>A <em>non-repeatable read</em> occurs when transaction A retrieves a row, transaction B subsequently updates the row, and transaction A later retrieves the same row again. Transaction A retrieves the same row twice but sees different data.</p>
<p>A <em>phantom read</em> occurs when transaction A retrieves a set of rows satisfying a given condition, transaction B subsequently inserts or updates a row such that the row now meets the condition in transaction A, and transaction A later repeats the conditional retrieval. Transaction A now sees an additional row. This row is referred to as a phantom.</p>
<p>Usually, you do not need to do anything about the transaction isolation level; you can just use the default one for your DBMS. The default transaction isolation level depends on your DBMS. For example, for Java DB, it is <code>TRANSACTION_READ_COMMITTED</code>. JDBC allows you to find out what transaction isolation level your DBMS is set to (using the <code>Connection</code> method <code>getTransactionIsolation</code>) and also allows you to set it to another level (using the <code>Connection</code> method <code>setTransactionIsolation</code>).</p>
<p><strong>Note</strong>: A JDBC driver might not support all transaction isolation levels. If a driver does not support the isolation level specified in an invocation of <code>setTransactionIsolation</code>, the driver can substitute a higher, more restrictive transaction isolation level. If a driver cannot substitute a higher transaction level, it throws a <code>SQLException</code>. Use the method <code>DatabaseMetaData.supportsTransactionIsolationLevel</code> to determine whether or not the driver supports a given level.</p>
<!-- ************************************** -->
<h2><a name="set_roll_back_savepoints" id="set_roll_back_savepoints">Setting and Rolling Back to Savepoints</a></h2>
<p>The method <code>Connection.setSavepoint</code>, sets a <code>Savepoint</code> object within the current transaction. The <code>Connection.rollback</code> method is overloaded to take a <code>Savepoint</code> argument.</p>
<p>The following method, <code><a href="gettingstarted.html">CoffeesTable.modifyPricesByPercentage</a></code>, raises the price of a particular coffee by a percentage, <code>priceModifier</code>. However, if the new price is greater than a specified price, <code>maximumPrice</code>, then the price is reverted to the original price:</p>
<div class="codeblock"><pre>
  public void modifyPricesByPercentage(
    String coffeeName,
    float priceModifier,
    float maximumPrice) throws SQLException {
    con.setAutoCommit(false);
    ResultSet rs = null;
    String priceQuery = "SELECT COF_NAME, PRICE FROM COFFEES " +
                        "WHERE COF_NAME = ?";
    String updateQuery = "UPDATE COFFEES SET PRICE = ? " +
                         "WHERE COF_NAME = ?";
    try (PreparedStatement getPrice = con.prepareStatement(priceQuery, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);
         PreparedStatement updatePrice = con.prepareStatement(updateQuery))
    {
      Savepoint save1 = con.setSavepoint();
      getPrice.setString(1, coffeeName);
      if (!getPrice.execute()) {
        System.out.println("Could not find entry for coffee named " + coffeeName);
      } else {
        rs = getPrice.getResultSet();
        rs.first();
        float oldPrice = rs.getFloat("PRICE");
        float newPrice = oldPrice + (oldPrice * priceModifier);
        System.out.printf("Old price of %s is $%.2f%n", coffeeName, oldPrice);
        System.out.printf("New price of %s is $%.2f%n", coffeeName, newPrice);
        System.out.println("Performing update...");
        updatePrice.setFloat(1, newPrice);
        updatePrice.setString(2, coffeeName);
        updatePrice.executeUpdate();
        System.out.println("\nCOFFEES table after update:");
        CoffeesTable.viewTable(con);
        if (newPrice > maximumPrice) {
          System.out.printf("The new price, $%.2f, is greater " +
                            "than the maximum price, $%.2f. " +
                            "Rolling back the transaction...%n",
                            newPrice, maximumPrice);
          con.rollback(save1);
          System.out.println("\nCOFFEES table after rollback:");
          CoffeesTable.viewTable(con);
        }
        con.commit();
      }
    } catch (SQLException e) {
      JDBCTutorialUtilities.printSQLException(e);
    } finally {
      con.setAutoCommit(true);
    }
  }
</pre></div>
<p>The following statement specifies that the cursor of the <code>ResultSet</code> object generated from the <code>getPrice</code> query is closed when the <code>commit</code> method is called. Note that if your DBMs does not support <code>ResultSet.CLOSE_CURSORS_AT_COMMIT</code>, then this constant is ignored:</p>
<div class="codeblock"><pre>
getPrice = con.prepareStatement(query, ResultSet.CLOSE_CURSORS_AT_COMMIT);
</pre></div>
<p>The method begins by creating a <code>Savepoint</code> with the following statement:</p>
<div class="codeblock"><pre>
Savepoint save1 = con.setSavepoint();
</pre></div>
<p>The method checks if the new price is greater than the <code>maximumPrice</code> value. If so, the method rolls back the transaction with the following statement:</p>
<div class="codeblock"><pre>
con.rollback(save1);
</pre></div>
<p>Consequently, when the method commits the transaction by calling the <code>Connection.commit</code> method, it will not commit any rows whose associated <code>Savepoint</code> has been rolled back; it will commit all the other updated rows.</p>
<!-- ************************************** -->
<h2><a name="release_savepoints" id="release_savepoints">Releasing Savepoints</a></h2>
<p>The method <code>Connection.releaseSavepoint</code> takes a <code>Savepoint</code> object as a parameter and removes it from the current transaction.</p>
<p>After a savepoint has been released, attempting to reference it in a rollback operation causes a <code>SQLException</code> to be thrown. Any savepoints that have been created in a transaction are automatically released and become invalid when the transaction is committed, or when the entire transaction is rolled back. Rolling a transaction back to a savepoint automatically releases and makes invalid any other savepoints that were created after the savepoint in question.</p>
<!-- ************************************** -->
<h2><a name="call_rollback" id="call_rollback">When to Call Method rollback</a></h2>
<p>As mentioned earlier, calling the method <code>rollback</code> terminates a transaction and returns any values that were modified to their previous values. If you are trying to execute one or more statements in a transaction and get a <code>SQLException</code>, call the method <code>rollback</code> to end the transaction and start the transaction all over again. That is the only way to know what has been committed and what has not been committed. Catching a <code>SQLException</code> tells you that something is wrong, but it does not tell you what was or was not committed. Because you cannot count on the fact that nothing was committed, calling the method <code>rollback</code> is the only way to be certain.</p>
<p>The method <code><a href="gettingstarted.html">CoffeesTable.updateCoffeeSales</a></code> demonstrates a transaction and includes a <code>catch</code> block that invokes the method <code>rollback</code>. If the application continues and uses the results of the transaction, this call to the <code>rollback</code> method in the <code>catch</code> block prevents the use of possibly incorrect data.</p>

        </div>
        <div class="NavBit">
            <a target="_top" href="prepared.html">&laquo; Previous</a>
            &bull;
            <a target="_top" href="../TOC.html">Trail</a>
            &bull;
            <a target="_top" href="rowset.html">Next &raquo;</a>
        </div>
    </div>
    
<hr class="clearfloat"/>

<div id="Footer">

<p class="footertext">
<a href="http://www.oracle.com/corporate/index.html">About Oracle</a> | 
<a href="http://www.oracle.com/us/corporate/contact/index.html">Contact Us</a> |
<a href="http://www.oracle.com/us/legal/index.html">Legal Notices</a> | 
<a href="http://www.oracle.com/us/legal/terms/index.html">Terms of Use</a> |
<a href="http://www.oracle.com/us/legal/privacy/index.html">Your Privacy Rights</a></p>

<p class="footertext"><a href="http://www.oracle.com/pls/topic/lookup?ctx=cpyr&id=en-US">
Copyright &copy; 1995, 2020 Oracle and/or its affiliates. All rights reserved.</a></p>
       
</div>    
    <div class="PrintHeaders">
        <b>Previous page:</b> Using Prepared Statements
        <br /><b>Next page:</b> Using RowSet Objects
    </div>
</body>
</html> 
