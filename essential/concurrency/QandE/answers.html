<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
    

<html lang="en-US" xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Answers to Questions and Exercises: Concurrency (The Java&trade; Tutorials &gt; Essential Classes &gt;
            Concurrency)</title>
            <meta http-equiv="X-UA-Compatible" content="IE=edge" />
<style type="text/css">
    body {
        margin-left:10px;
        margin-right:10px;
        line-height: 1.5;
        FONT-FAMILY: Arial, Helvetica, sans-serif; 
        font-size: 0.8em;
    }
    
    a:link{text-decoration:none; color:#09569d;}
    a:visited{text-decoration:none; color: #3a87cf;}
    a:hover{text-decoration:underline; }
        
    code{
        font-family:Monaco,Courier,"Courier New";
    }
    
    .header-container {
        background-color: #fff;
        border-bottom: 1px solid #C1CFDA;
        -webkit-box-shadow: 0 2px 2px rgba(117, 163, 231, 0.1);
        box-shadow: 0 2px 2px rgba(117, 163, 231, 0.1);
    }
    
    .bookwrapper {
        width: auto;
        margin: auto;
    }
    
    .clearfix {
    }
    
    .clearfloat {
        clear: both;
        overflow: auto;
        height: 0px;
        font-size: 1px;
        line-height: 0px;
    }
    
    #brandProdName {
        width: auto;
        height: auto;
    }
    
    #logocover {
        display: block;
        background: transparent url(../../../images/oracle-java-logo.png) 0px 0px no-repeat;
        height: 50px;
        width: 229px;
        float: left;
    }
    
    #productName {
        font-size: 16px;
        position: relative;
        top: 19px;
        padding-left: 3px;
        color: #457798;
        white-space: nowrap;
        width: 340px;
    }


    .FigureCaption   { 
        font-family: sans-serif; 
        text-align: center;
    }
    
    #TopBar_bl {        
        width: 100%;
        height: 60px;
    }
    #TopBar_br {
        width: 100%;
        height: 60px;
    }
    #TopBar_tl {
        margin-left: -110px;
        margin-right: -100px;       
		align: left;
        height: 60px;
    }
    #TopBar_tr {
        width: 100%;
        height: 60px;
    }
    
    #TopBar {
        min-width:700px;
        padding:25px 100px 10px;
        margin-bottom:25px;
        clear:both;
        
        border-bottom:1px solid #d2dde5;
        border-radius: 3px;
    
        background:#efefef; /* Old browsers */
        /* IE9 SVG, needs conditional override of 'filter' to 'none' */
        background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlMmVmZjkiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);
        background: -moz-linear-gradient(top,  #ffffff 0%, #e2eff9 100%); /* FF3.6+ */
        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#ffffff), color-stop(100%,#e2eff9)); /* Chrome,Safari4+ */
        background: -webkit-linear-gradient(top,  #ffffff 0%,#e2eff9 100%); /* Chrome10+,Safari5.1+ */
        background: -o-linear-gradient(top,  #ffffff 0%,#e2eff9 100%); /* Opera 11.10+ */
        background: -ms-linear-gradient(top,  #ffffff 0%,#e2eff9 100%); /* IE10+ */
        background: linear-gradient(to bottom,  #ffffff 0%,#e2eff9 100%); /* W3C */
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffffff', endColorstr='#e2eff9',GradientType=0 ); /* IE6-8 */
        
    }
    
    #TopBar_left {
        line-height: 14px;
        position: absolute;
        padding-top: 30px;
        padding-right: 30px;
        padding-left: 30px;
        text-align: left;
        font: 13px/20px Arial, Helvetica, sans-serif;
        font-weight: bold;
        font-size: 20px;
        color: #333;
    }
    
    #TopBar_right {
        line-height: 12px;
        float: right;
        padding-top: 10px;
        padding-right: 30px;
        text-align: left;
    }
    

    @media print {
        #BreadCrumbs, #Download {
            display: none;
        }
    }
    
     
    @media print {
        #TopBar_right {
            display: none;
        }
    }
    #TopBar_right a {
        font-size: 10px;
        margin: 3px;
        padding: 0;
    }
 
    #BreadCrumbs {
        padding: 15px 5px 0.5em 0;
        font-family: sans-serif; 
        float: right;
    }
    
    #BreadCrumbs a {
        color:#09569d;
    }
    
    #BreadCrumbs a:visited, #BreadCrumbs a:link {
        text-decoration: none;
    }
    
    #BreadCrumbs a:hover, #BreadCrumbs a:active {
        text-decoration: underline;
    }
    
    #PageTitle {
        margin: 0 5px 0.5em 0;
        color: #F90000;
    }
    
    #PageContent{
        margin: 0 5px 0 20px;
    }
    
    .LeftBar_shown {
        width: 13em;
        float: left;
    }
    
    @media print {
        .LeftBar_shown {
            display: none;
        }
    }
    
    .LeftBar_hidden {
        display: none;
    }
    
    #Footer {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;       
    }
    
    .footertext {
        font-size: 10px;
        font-family: sans-serif; 
        margin-top: 1px;
    }

    .NavBit  {
        padding: 15px 5px 0.5em 0;
        font-family: sans-serif; 
    }
    
    @media print {
        .NavBit {
            display: none;
        }
    }
    
    #TagNotes {
        text-align: right;        
    }
    
    @media print {
        #TagNotes a:visited, #TagNotes a:link {
            color: #35556B;
            text-decoration: none;
        }
    }
    
    #Contents a, .NavBit a, #TagNotes a {
        color:#09569d;
    }
    
    #TagNotes a:visited, #TagNotes a:link,
    #Contents a:visited, #Contents a:link,
    .NavBit a:visited, .NavBit a:link {
        text-decoration: none;
    }
    
    #TagNotes a:hover, #TagNotes a:active,   
    #Contents a:hover, #Contents a:active,   
    .NavBit a:hover, .NavBit a:active {  
        text-decoration: underline;
    }
    
    #Contents {
        float: left;
        font-family: sans-serif; 
    }
    @media print {
        #Contents {
            display: none;
        }
    }
    @media screen {
        div.PrintHeaders {
            display: none;
        }
    }
    .linkLESSON, .nolinkLESSON {
        margin-left: 0.5em;
        text-indent: -0.5em;
    }
    .linkAHEAD, .nolinkAHEAD, .linkQUESTIONS, .nolinkQUESTIONS   {
        margin-left: 1.5em; 
        text-indent: -0.5em
    }
    .linkBHEAD, .nolinkBHEAD   {
        margin-left: 2.5em;
        text-indent: -0.5em
    }
    .linkCHEAD, .nolinkCHEAD   {
        margin-left: 3.5em;
        text-indent: -0.5em
    }
    .nolinkLESSON, .nolinkAHEAD, .nolinkBHEAD, .nolinkCHEAD,
    .nolinkQUESTIONS {
        font-weight: bold;
        color: #333;
		
		
    }
    .MainFlow_indented {
        margin-right: 10px;
        margin-left: 15em;
        margin-bottom: 2em;

    }
    .MainFlow_wide {
	
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 2em;

    }
    @media print {
        .MainFlow_indented, .MainFlow_wide {
            padding-top: 0;
            margin-top: 10px;
            margin-right: 10px;
            margin-left: 0;
        }
    }
    h1, h2, h3, h4, h5 {
        color: #333;
        
    }

    h1 {
        font-weight: bold;
        font-size: 20px;
    }

    h2 {
        font-weight: bold;
        font-size: 17px;
    }

    h3 {
        font-weight: bold;
        font-size: 14px;
    }

    h4 {
        font-size: 15px;
    }

    h5 {
        font-size: 12px;
    }


    #ToggleLeft {
        display: none;
    }
    
    .note {
        margin: 0 30px 0px 30px;
    }
    
    .codeblock {
        margin: 0 30px 0px 30px;
		font-size:12px;
		font-family:Monaco,Courier,"Courier New";
    }
    
    .tocli {
        list-style-type:none;
    }

    .betadraft {
        color: red;
    }

</style>
    </head>
<body>
    <noscript> 
        A browser with JavaScript enabled is required for this page to operate properly.
    </noscript>
        <!-- altheader -->
     <div class="header-container">
        <div class="bookwrapper  clearfix">       
            <div id="brandProdName">
                <div id="logocover"></div>
                <div id="productName" >Documentation</div>
            </div> 
            <br class="clearfloat" />
        </div>
    </div>
    
    <div id="TopBar">
        <div id="TopBar_tr"> <div id="TopBar_tl"> <div id="TopBar_br"> <div id="TopBar_bl"> 
                        <div id="TopBar_left">
                            The Java&trade; Tutorials
                        </div>
                        <div id="TopBar_right">
<script type="text/javascript">function search() { var sform = document.getElementById("searchForm"); var srchelem = document.getElementById("searchField"); var srchelemreal = document.getElementById("keywordreal"); var srchval = srchelem.value; if (srchval.length == 0) { return false; } srchelemreal.value = srchval; sform.action = "http://docs.oracle.com/apps/search/search.jsp"; sform.method = "get"; sform.target = "_blank"; sform.submit(); }</script><form id="searchForm" onsubmit="return search()"><input type="hidden" name="category" value="java"/><input type="hidden" name="product" value="e25407-01"/><input type="hidden" name="q" value="" id="keywordreal"/><label for="searchField"><input type="text" id="searchField" size="30" onclick="this.value='';" /></label><input type="submit" value="Search" /></form>                        
                        </div>
                            <div class="PrintHeaders">
                                <b>Trail:</b> Essential Classes
                                <br /><b>Lesson:</b> Concurrency
                            </div>
                    </div> </div> </div> </div> </div>

    <div class="MainFlow_wide">
        <span id="BreadCrumbs">
            <a href="../../../index.html" target="_top">Home Page</a>
            &gt;
            <a href="../../index.html" target="_top">Essential Classes</a>
            &gt;
            <a href="../index.html" target="_top">Concurrency</a>
        </span>
        <div class="NavBit">
            <a href="../QandE/questions.html">&laquo; Previous</a>&nbsp;&bull;&nbsp;<a href="../../TOC.html">TOC</a>
        </div>
        <div class="Banner"><p style="background-color: rgb(247, 248, 249); border-width: 1px; padding: 10px; font-style: italic; border-style: solid; border-color: rgb(64, 74, 91);">The Java Tutorials have been written for JDK 8. Examples and practices described in this page don't take advantage of improvements introduced in later releases and might use technology no longer available.<br/>See <a href="https://docs.oracle.com/pls/topic/lookup?ctx=en/java/javase&id=java_language_changes">Java Language Changes</a> for a summary of updated language features in Java SE 9 and subsequent releases.<br/>See <a href="https://www.oracle.com/technetwork/java/javase/jdk-relnotes-index-2162236.html">JDK Release Notes</a> for information about new features, enhancements, and removed or deprecated options for all JDK releases.</p></div>
        <div id="PageTitle"><h1>Answers to Questions and Exercises: Concurrency</h1></div>
        <div id="PageContent">

<h2>Questions</h2>
<ol>
<li><b>Question:</b> Can you pass a <code>Thread</code> object to <code>Executor.execute</code>? Would such an invocation make sense? Why or why not?
<p><b>Answer:</b> <code>Thread</code> implements the <code>Runnable</code> interface, so you can pass an instance of <code>Thread</code> to <code>Executor.execute</code>. However it doesn&#39;t make sense to use <code>Thread</code> objects this way. If the object is directly instantiated from <code>Thread</code>, its <code>run</code> method doesn&#39;t do anything. You can define a subclass of <code>Thread</code> with a useful <code>run</code> method &#151; but such a class would implement features that the executor would not use.</p>
</li>
</ol>
<h2>Exercises</h2>
<ol>
<li><b>Exercise:</b> Compile and run 
<a class="SourceLink" target="_blank" href="BadThreads.java" onclick="showCode('../../../displayCode.html', 'BadThreads.java'); return false;"><code><code>BadThreads.java</code></code></a>:
<div class="codeblock"><pre>

public class BadThreads {

    static String message;

    private static class CorrectorThread
        extends Thread {

        public void run() {
            try {
                sleep(1000); 
            } catch (InterruptedException e) {}
            // Key statement 1:
            message = &quot;Mares do eat oats.&quot;; 
        }
    }

    public static void main(String args[])
        throws InterruptedException {

        (new CorrectorThread()).start();
        message = &quot;Mares do not eat oats.&quot;;
        Thread.sleep(2000);
        // Key statement 2:
        System.out.println(message);
    }
}
</pre></div>
<p>The application should print out &quot;Mares do eat oats.&quot; Is it guaranteed to always do this? If not, why not? Would it help to change the parameters of the two invocations of <code>Sleep</code>? How would you guarantee that all changes to <code>message</code> will be visible to the main thread?</p>
<p><b>Solution:</b> The program will almost always print out &quot;Mares do eat oats.&quot; However, this result is not guaranteed, because there is no happens-before relationship between &quot;Key statement 1&quot; and &quot;Key statment 2&quot;. This is true even if &quot;Key statement 1&quot; actually executes before &quot;Key statement 2&quot; &#151; remember, a happens-before relationship is about visibility, not sequence.</p>
<p>There are two ways you can guarantee that all changes to <code>message</code> will be visible to the main thread:</p>
<ul>
<li>In the main thread, retain a reference to the <code>CorrectorThread</code> instance. Then invoke <code>join</code> on that instance before referring to <code>message</code></li>
<li>Encapsulate <code>message</code> in an object with synchronized methods. Never reference <code>message</code> except through those methods.</li>
</ul>
<p>Both of these techniques establish the necessary happens-before relationship, making changes to <code>message</code> visible.</p>
<p>A third technique is to simply declare <code>message</code> as <code>volatile</code>. This guarantees that any write to <code>message</code> (as in &quot;Key statement 1&quot;) will have a happens-before relationship with any subsequent reads of <code>message</code> (as in &quot;Key statement 2&quot;). But it does not guarantee that &quot;Key statement 1&quot; will <i>literally</i> happen before &quot;Key statement 2&quot;. They will <i>probably</i> happen in sequence, but because of scheduling uncertainities and the unknown granularity of <code>sleep</code>, this is not guaranteed.</p>
<p>Changing the arguments of the two <code>sleep</code> invocations does not help either, since this does nothing to guarantee a happens-before relationship.</p>
</li>
<li><b>Exercise:</b> Modify the producer-consumer example in <a href="../guardmeth.html">Guarded Blocks</a> to use a standard library class instead of the <code>Drop</code> class.
<p><b>Solution:</b> The 
<a class="APILink" target="_blank" href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html"><code>java.util.concurrent.BlockingQueue</code></a> interface defines a <code>get</code> method that blocks if the queue is empty, and a <code>put</code> methods that blocks if the queue is full. These are effectively the same operations defined by <code>Drop</code> &#151; except that <code>Drop</code> is not a queue! However, there&#39;s another way of looking at Drop: it&#39;s a queue with a capacity of zero. Since there&#39;s no room in the queue for <i>any</i> elements, every <code>get</code> blocks until the corresponding <code>take</code> and every <code>take</code> blocks until the corresponding <code>get</code>. There is an implementation of <code>BlockingQueue</code> with precisely this behavior: 
<a class="APILink" target="_blank" href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/SynchronousQueue.html"><code>java.util.concurrent.SynchronousQueue</code></a>.</p>
<p><code>BlockingQueue</code> is almost a drop-in replacement for <code>Drop</code>. The main problem in 
<a class="SourceLink" target="_blank" href="Producer.java" onclick="showCode('../../../displayCode.html', 'Producer.java'); return false;"><code><code>Producer</code></code></a> is that with <code>BlockingQueue</code>, the <code>put</code> and <code>get</code> methods throw <code>InterruptedException</code>. This means that the existing <code>try</code> must be moved up a level:</p>
<div class="codeblock"><pre>

import java.util.Random;
import java.util.concurrent.BlockingQueue;

public class Producer implements Runnable {
    private BlockingQueue&lt;String&gt; drop;

    public Producer(BlockingQueue&lt;String&gt; drop) {
        this.drop = drop;
    }

    public void run() {
        String importantInfo[] = {
            &quot;Mares eat oats&quot;,
            &quot;Does eat oats&quot;,
            &quot;Little lambs eat ivy&quot;,
            &quot;A kid will eat ivy too&quot;
        };
        Random random = new Random();

        try {
            for (int i = 0;
                 i &lt; importantInfo.length;
                 i++) {
                drop.put(importantInfo[i]);
                Thread.sleep(random.nextInt(5000));
            }
            drop.put(&quot;DONE&quot;);
        } catch (InterruptedException e) {}
    }
}
</pre></div>
Similar changes are required for 
<a class="SourceLink" target="_blank" href="Consumer.java" onclick="showCode('../../../displayCode.html', 'Consumer.java'); return false;"><code><code>Consumer</code></code></a>:
<div class="codeblock"><pre>

import java.util.Random;
import java.util.concurrent.BlockingQueue;

public class Consumer implements Runnable {
    private BlockingQueue&lt;String&gt; drop;

    public Consumer(BlockingQueue&lt;String&gt; drop) {
        this.drop = drop;
    }

    public void run() {
        Random random = new Random();
        try {
            for (String message = drop.take();
                 ! message.equals(&quot;DONE&quot;);
                 message = drop.take()) {
                System.out.format(&quot;MESSAGE RECEIVED: %s%n&quot;,
                                  message);
                Thread.sleep(random.nextInt(5000));
            }
        } catch (InterruptedException e) {}
    }
}
</pre></div>
For 
<a class="SourceLink" target="_blank" href="ProducerConsumerExample.java" onclick="showCode('../../../displayCode.html', 'ProducerConsumerExample.java'); return false;"><code><code>ProducerConsumerExample</code></code></a>, we simply change the declaration for the <code>drop</code> object:
<div class="codeblock"><pre>

import java.util.concurrent.BlockingQueue;
import java.util.concurrent.SynchronousQueue;

public class ProducerConsumerExample {
    public static void main(String[] args) {
        BlockingQueue&lt;String&gt; drop =
            new SynchronousQueue&lt;String&gt; ();
        (new Thread(new Producer(drop))).start();
        (new Thread(new Consumer(drop))).start();
    }
}
</pre></div>
</li>
</ol>


        </div>
    </div>
    <div class="NavBit">
        <a href="../QandE/questions.html">&laquo; Previous</a>
        &bull;
        <a href="../../TOC.html">TOC</a>
    </div>
<hr class="clearfloat"/>

<div id="Footer">

<p class="footertext">
<a href="http://www.oracle.com/corporate/index.html">About Oracle</a> | 
<a href="http://www.oracle.com/us/corporate/contact/index.html">Contact Us</a> |
<a href="http://www.oracle.com/us/legal/index.html">Legal Notices</a> | 
<a href="http://www.oracle.com/us/legal/terms/index.html">Terms of Use</a> |
<a href="http://www.oracle.com/us/legal/privacy/index.html">Your Privacy Rights</a></p>

<p class="footertext"><a href="http://www.oracle.com/pls/topic/lookup?ctx=cpyr&id=en-US">
Copyright &copy; 1995, 2020 Oracle and/or its affiliates. All rights reserved.</a></p>
       
</div>
    <div class="PrintHeaders">
        <b>Previous page:</b> Questions and Exercises: Concurrency
    </div>
</body>
</html> 



